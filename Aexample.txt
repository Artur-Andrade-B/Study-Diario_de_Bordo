from flask import Flask,render_template,request
from sqlalchemy import create_engine, MetaData
from sqlalchemy.orm import sessionmaker
from sqlalchemy.ext.automap import automap_base
import pymysql
import urllib.parse
from aluno import Aluno
import random
import pandas as pd


user = "root"
password = urllib.parse.quote_plus("senai@123")

host = "localhost"
database = "projetodiario"

connection_string = f"mysql+pymysql://{user}:{password}@{host}/{database}"

engine = create_engine(connection_string)

query_aluno = "SELECT * FROM aluno"
query_avaliacao = "SELECT * FROM avaliacao"
query_diariobordo = "SELECT * FROM diariobordo"

df_alunos = pd.read_sql(query_aluno,engine)


test = random.randrange(1,1000000)
routevar = "/login"


app = Flask(__name__)

@app.route("/alomundo")
def ola():
    return "Hello world!"

@app.route("/")
def index():
    return render_template("index.html")

@app.route(f"/{test}")
def register_aluno():
     return render_template("novoaluno.html")

@app.route(f"{routevar}", methods=["POST"])
def login_ra():
    global df_alunos
    ra = request.form["ra"]
    if ra in df_alunos.values:
        list_al = df_alunos.loc[df_alunos["ra"] == ra]
        loc = list_al.index.to_list()[0]
        nome = list_al.at[loc, "nome"]
        return render_template("diariobordo.html", ra = ra, nome = nome)
    else:
        mensagem = "o ra est√° invalido"
        return render_template("index.html", mensagem = mensagem)

@app.route("/diariodebordo")
def diario_bordo():
    return render_template("diariobordo.html")

app.run()